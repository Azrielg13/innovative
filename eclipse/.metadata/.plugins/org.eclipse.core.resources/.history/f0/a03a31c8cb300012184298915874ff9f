package com.sce.esp.dialog;

import java.awt.BorderLayout;
import java.awt.Component;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.Label;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.IOException;

import javax.swing.JButton;
import javax.swing.JCheckBox;
import javax.swing.JDialog;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;

import net.miginfocom.swing.MigLayout;

import com.jidesoft.dialog.JideOptionPane;
import com.jidesoft.plaf.LookAndFeelFactory;
import com.sce.esp.util.IconsFactory;
import com.sce.esp.util.ui.HyperLinkLabel;

public class ProxyCheckDialog implements ActionListener{
	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
	private JCheckBox okCheckBox; 
	private JButton okayButton,  ctrlPanelBtn;
	private Label proxyMessage, instructLabel;
	private JTextArea textArea;
	private JDialog dialog; 
	private Component parent;

	public ProxyCheckDialog(Component parent){
		this.parent = parent;
		init();
	}

	public void init(){										//initiate all the components
		proxyMessage = new Label("Oops! Your proxy settings are incorrect.");
		proxyMessage.setFont(new Font("Ariel", Font.BOLD, 12));
//		instructLabel = new Label("To Fix: ");
//		instructLabel.setFont(new Font("Ariel", Font.BOLD, 12));
		okCheckBox = new JCheckBox ("  Yes, I have read the instructions."); 
		okCheckBox.addActionListener(this);
		ctrlPanelBtn = new JButton("Open Java Control Panel");
		ctrlPanelBtn.addActionListener(this);
		okayButton = new JButton("OK");
		okayButton.setMaximumSize(new Dimension(70,20));
		okayButton.setEnabled(false);
		okayButton.addActionListener(this);
		
		textArea = new JTextArea("Don't worry, MDI is  still working correctly, but you need to   make some changes in order to send notifications. It will only  take a minute to do.\n\n"
				+ "For instructions to change your proxy settings click on the link below.\n\n"
				+ "You can click on the 'Open Java Control Panel' button below to view your proxy settings." , 9,38);
		textArea.setEditable(false);
		textArea.setLineWrap(true);

		createDialog();
	}

	public void createDialog(){								// build the dialog
		JPanel n1Panel = new JPanel(new BorderLayout());	//north panel1
//		n1Panel.add(instructLabel, BorderLayout.WEST);
		n1Panel.add(new JScrollPane(textArea), BorderLayout.SOUTH);

		JPanel s1Panel = new JPanel(new BorderLayout());
		s1Panel.setPreferredSize(new Dimension(310,30));
		s1Panel.add(new HyperLinkLabel("<html><u>Proxy Setup Instruction</u></html>",null,"http://mdi/docs/Instructions%20for%20Launch%20Error.pdf"), BorderLayout.WEST);
		s1Panel.add(ctrlPanelBtn, BorderLayout.EAST);

		JPanel proxyPane = new JPanel(new MigLayout());
		proxyPane.add(proxyMessage, "wrap"); 
		proxyPane.add(n1Panel, "wrap"); 
		proxyPane.add(s1Panel, "wrap "); 
		proxyPane.add(okCheckBox, "wrap"); 

		Object[] option = new Object[1];					//create a dialog
		option[0] = okayButton;
		Object[] message = new Object[1];
		message[0] = proxyPane;
		JideOptionPane pane = new JideOptionPane(
				message,                                    				// pass a panel to a dialog
				JOptionPane.DEFAULT_OPTION,                 				// option type
				JOptionPane.ERROR_MESSAGE,            						// message type
				IconsFactory.getScaledImageIcon(IconsFactory.Test.PROXY_SETTING,32),   // optional icon, use null to use the default icon
				option,                                    					// options string array, will be made into buttons
				option[0]                                  					// option that should be made into a default button
		);
		dialog = pane.createDialog(null, "Proxy Setting Error - MDI");			// set the dialog title
		dialog.setLocationRelativeTo(parent);
		dialog.setDefaultCloseOperation(JDialog.DO_NOTHING_ON_CLOSE);
		dialog.setVisible(true);
	}

	public void actionPerformed(ActionEvent ae) {
		if(ae.getSource()==ctrlPanelBtn){
			try {
				Runtime.getRuntime().exec(new String[]{ "rundll32", "url.dll,FileProtocolHandler", System.getProperty("sun.boot.library.path").toString()+"\\javacpl.exe" });
			} catch (IOException e) {
				e.printStackTrace();
			}
		}
		if(ae.getSource()==okCheckBox)
			if(okCheckBox.isSelected())
				okayButton.setEnabled(true);
			else okayButton.setEnabled(false);
		if(ae.getSource()==okayButton)
			dialog.dispose();
	}

	public static void main(String[] args) {
		LookAndFeelFactory.installDefaultLookAndFeelAndExtension();
		new ProxyCheckDialog(null);
	}
}

